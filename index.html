<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEPM Risk Management Bingo</title>
  <!-- Google Font with a Chinese-inspired style -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* Global Styles with Chinese Theme */
    body {
      font-family: 'Noto Serif SC', serif;
      background: url('background.jpg') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 20px;
      color: #fff;
      text-align: center;
      overflow-x: hidden;
      background-color: #000;
    }
    h1 {
      font-size: 3.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 6px rgba(0,0,0,0.5);
      color: #ffd700;
    }
    /* Instruction Box */
    #instruction {
      background-color: rgba(220, 20, 60, 0.8);
      border: 3px solid #ffd700;
      border-radius: 15px;
      padding: 20px;
      margin: 0 auto 20px;
      max-width: 800px;
      font-size: 1.2em;
      box-shadow: 0px 4px 15px rgba(0,0,0,0.4);
      backdrop-filter: blur(4px);
    }
    /* Timer */
    #timer {
      font-size: 1.4em;
      margin: 10px 0;
      display: none;
      animation: pulse 1.5s infinite;
      color: #ffd700;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    /* Bingo Container */
    #bingo-container {
      display: inline-block;
      margin: 20px auto;
      border: 3px solid #ffd700;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0px 4px 15px rgba(0,0,0,0.4);
    }
    table {
      border-collapse: collapse;
      margin: 0 auto;
    }
    td {
      border: 2px solid #ffd700;
      padding: 20px;
      width: 120px;
      height: 80px;
      cursor: pointer;
      background-color: rgba(0, 0, 0, 0.5);
      transition: background-color 0.3s, transform 0.3s;
      font-weight: bold;
      font-size: 1.1em;
      border-radius: 8px;
      position: relative;
      overflow: hidden;
    }
    td:hover:not(.locked) {
      background-color: rgba(255, 215, 0, 0.3);
      transform: scale(1.05);
    }
    td.selected {
      background-color: #ffd700;
      transform: scale(1.1);
      animation: pulseSelect 0.5s ease-out;
      color: #000;
    }
    @keyframes pulseSelect {
      0% { transform: scale(1.05); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1.05); }
    }
    td.locked {
      background-color: #32cd32;
      cursor: default;
      animation: popLocked 0.6s ease-out;
      color: #000;
    }
    @keyframes popLocked {
      0% { transform: scale(0.8); opacity: 0.5; }
      100% { transform: scale(1); opacity: 1; }
    }
    /* Controls */
    #controls {
      margin: 20px;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      margin: 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.3s;
      box-shadow: 0px 3px 6px rgba(0,0,0,0.3);
    }
    button:hover {
      transform: scale(1.05);
    }
    #start-btn {
      background-color: #dc143c;
      color: #ffd700;
    }
    #shuffle-btn {
      background-color: #8b0000;
      color: #ffd700;
    }
    #confirm-btn {
      background-color: #4caf50;
      color: #fff;
    }
    #confirm-btn:disabled {
      background-color: #9e9e9e;
      cursor: not-allowed;
    }
    /* Surprise overlay style */
    #surprise-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      color: #ffd700;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 1000;
      animation: fadeIn 1s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    #surprise-overlay h2 {
      font-size: 3em;
      margin-bottom: 20px;
      text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
    }
    #surprise-overlay button {
      padding: 10px 20px;
      font-size: 1.2em;
      background-color: #ff5722;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      color: #fff;
      box-shadow: 0px 3px 6px rgba(0,0,0,0.3);
      transition: background-color 0.3s, transform 0.3s;
    }
    #surprise-overlay button:hover {
      transform: scale(1.05);
    }
    
    /* Responsive Styles for Mobile */
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      h1 {
        font-size: 2.5em;
      }
      #instruction {
        font-size: 1em;
        padding: 15px;
      }
      #timer {
        font-size: 1.2em;
      }
      button {
        padding: 8px 16px;
        font-size: 0.9em;
      }
      td {
        width: 80px;
        height: 60px;
        padding: 10px;
        font-size: 0.9em;
      }
    }
  </style>
</head>
<body>
  <h1>SEPM Risk Management Bingo</h1>
  <div id="instruction">
    <p>Before you begin, use the "Shuffle Board" button to rearrange the symbols of destiny.<br>
    When ready, click "Start Game" to begin your 30-second turns. In each turn, select one sacred cell and click "Confirm Answer" to seal its fate.</p>
  </div>
  <div id="timer">
    Time remaining: <span id="time-remaining">30</span> seconds
  </div>
  <div id="controls">
    <button id="start-btn">Start Game</button>
    <button id="shuffle-btn">Shuffle Board</button>
    <button id="confirm-btn" disabled>Confirm Answer</button>
  </div>
  <div id="bingo-container">
    <table id="bingo-table"></table>
  </div>

  <!-- Surprise Ending Overlay -->
  <div id="surprise-overlay">
    <h2>Bingo! Fortune Favors You!</h2>
    <p>You have unlocked the ancient fortune of Risk Management!</p>
    <button onclick="resetGame()">Play Again</button>
  </div>

  <script>
    // List of risk words for the bingo board.
    const riskWords = [
      "Security", "Budget", "Scope", "Schedule", "Technology",
      "Compliance", "Reputation", "Resource", "Market", "Legal",
      "Operational", "Quality", "Environmental", "Financial", "Political",
      "Cultural", "Safety", "Personnel", "Supply", "Customer",
      "Infrastructure", "Strategic", "Data", "Innovation", "Ethics"
    ];

    let timerInterval;
    let timeRemaining = 30;
    let selectionLocked = false;
    let selectedWord = null;
    let gameStarted = false;

    const timeRemainingEl = document.getElementById('time-remaining');
    const timerEl = document.getElementById('timer');
    const startBtn = document.getElementById('start-btn');
    const shuffleBtn = document.getElementById('shuffle-btn');
    const confirmBtn = document.getElementById('confirm-btn');
    const table = document.getElementById('bingo-table');
    const overlay = document.getElementById('surprise-overlay');

    // Fisher-Yates shuffle.
    function shuffle(array) {
      let currentIndex = array.length, randomIndex;
      while (currentIndex !== 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
      }
      return array;
    }

    // Build the bingo board.
    function buildBingoBoard() {
      table.innerHTML = "";
      const shuffledWords = shuffle([...riskWords]);
      for (let i = 0; i < 5; i++) {
        let row = table.insertRow();
        for (let j = 0; j < 5; j++) {
          let cell = row.insertCell();
          let word = shuffledWords[i * 5 + j];
          cell.innerText = word;
          cell.dataset.row = i;
          cell.dataset.col = j;
          cell.classList.remove('selected', 'locked');
          cell.addEventListener('click', () => {
            if (gameStarted && !selectionLocked && !cell.classList.contains('locked')) {
              // Deselect any previously selected cell.
              document.querySelectorAll('#bingo-table td').forEach(c => c.classList.remove('selected'));
              cell.classList.add('selected');
              selectedWord = cell.innerText;
              confirmBtn.disabled = false;
            }
          });
        }
      }
    }

    // Start a new turn: reset timer and clear current selection.
    function startTurn() {
      clearInterval(timerInterval);
      timeRemaining = 30;
      timeRemainingEl.innerText = timeRemaining;
      selectedWord = null;
      confirmBtn.disabled = true;
      selectionLocked = false;
      // Remove any selected state.
      document.querySelectorAll('#bingo-table td').forEach(cell => cell.classList.remove('selected'));
      timerInterval = setInterval(() => {
        timeRemaining--;
        timeRemainingEl.innerText = timeRemaining;
        if (timeRemaining <= 0) {
          clearInterval(timerInterval);
          selectionLocked = true;
          confirmBtn.disabled = true;
          alert("Time's up! The fates have spoken. Starting a new turn.");
          startTurn(); // Automatically start a new turn.
        }
      }, 1000);
    }

    // Confirm button event: lock the selected cell.
    confirmBtn.addEventListener('click', function () {
      if (selectedWord) {
        selectionLocked = true;
        clearInterval(timerInterval);
        // Lock the cell that was selected.
        document.querySelectorAll('#bingo-table td').forEach(cell => {
          if (cell.innerText === selectedWord && cell.classList.contains('selected')) {
            cell.classList.add('locked');
            cell.classList.remove('selected');
          }
        });
        confirmBtn.disabled = true;
        // Check for bingo.
        if (checkBingo()) {
          showSurprise();
        } else {
          // Start next turn after a short delay.
          setTimeout(startTurn, 500);
        }
      }
    });

    // Check for bingo (complete row, column, or diagonal).
    function checkBingo() {
      const cells = table.getElementsByTagName('td');
      let grid = [];
      for (let i = 0; i < 5; i++) {
        grid[i] = [];
        for (let j = 0; j < 5; j++) {
          grid[i][j] = false;
        }
      }
      for (let cell of cells) {
        let r = parseInt(cell.dataset.row);
        let c = parseInt(cell.dataset.col);
        // Only consider locked cells.
        grid[r][c] = cell.classList.contains('locked');
      }
      // Check rows and columns.
      for (let i = 0; i < 5; i++) {
        if (grid[i].every(val => val)) return true;
        let colComplete = true;
        for (let j = 0; j < 5; j++) {
          if (!grid[j][i]) {
            colComplete = false;
            break;
          }
        }
        if (colComplete) return true;
      }
      // Check diagonals.
      let diag1 = true, diag2 = true;
      for (let i = 0; i < 5; i++) {
        if (!grid[i][i]) diag1 = false;
        if (!grid[i][4-i]) diag2 = false;
      }
      return diag1 || diag2;
    }

    // Show the surprise ending overlay.
    function showSurprise() {
      overlay.style.display = 'flex';
    }

    // Reset game: rebuild the board and restart the turn.
    function resetGame() {
      overlay.style.display = 'none';
      gameStarted = false;
      // Enable shuffle and start buttons.
      shuffleBtn.disabled = false;
      startBtn.disabled = false;
      buildBingoBoard();
      timerEl.style.display = "none";
    }

    // Start game button event.
    startBtn.addEventListener('click', function () {
      gameStarted = true;
      // Once game starts, disable the start and shuffle buttons.
      startBtn.disabled = true;
      shuffleBtn.disabled = true;
      timerEl.style.display = "block";
      startTurn();
    });

    // Shuffle button event (active only before the game starts).
    shuffleBtn.addEventListener('click', buildBingoBoard);

    // Initialize board.
    buildBingoBoard();
  </script>
</body>
</html>
